<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buscar usuarios - Gestor Docs G3</title>
  <link rel="stylesheet" href="/assets/styles.css">
  <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <script src="/components/navbar.js"></script>
  <div class="form-container">
    <h1 class="form-title">🔍 Buscar usuarios</h1>
    <form id="buscarForm">
      <div class="form-group">
        <label for="user" class="form-label">Nombre de usuario</label>
        <input type="text" name="user" id="user" class="form-input" placeholder="Ej: admin, user">
      </div>
      <button type="submit" class="btn-primary" style="width: 100%; justify-content: center;">🔍 Buscar usuario</button>
    </form>
    <div id="resultado"></div>
    <a href="/dashboard" class="back-link">← Volver al panel</a>
  </div>
  <script>
    renderNavbar('buscar-usuarios');
    document.getElementById('buscarForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const user = document.getElementById('user').value;
      const resultDiv = document.getElementById('resultado');
      resultDiv.innerHTML = '<div class="result-container">🔄 Buscando...</div>';
      fetch('/api/usuarios/buscar', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
          'X-Requested-With': 'XMLHttpRequest'
        },
        credentials: 'same-origin',
        body: `user=${encodeURIComponent(user)}`
      })      .then(r => r.json())
      .then(data => {
        if (data && data.usuarios && data.usuarios.length > 0) {
          let html = `<div class="result-container">
            <h3>📊 Resultados encontrados: ${data.total} usuario(s)</h3>
            <div style="margin-top: 16px;">`;
          
          data.usuarios.forEach(usuario => {
            html += `
              <div style="margin-bottom: 16px; padding: 16px; background: var(--neutral-50); border: 1px solid var(--neutral-200); border-radius: 8px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
                  <div>
                    <strong style="color: var(--primary-600);">ID:</strong>
                    <span>${usuario.id}</span>
                  </div>
                  <div>
                    <strong style="color: var(--primary-600);">Usuario:</strong>
                    <span>${usuario.username}</span>
                  </div>
                  <div>
                    <strong style="color: var(--red-600);">Contraseña:</strong>
                    <span style="font-family: monospace; background: var(--red-50); padding: 2px 6px; border-radius: 4px;">${usuario.password}</span>
                  </div>
                  <div>
                    <strong style="color: var(--primary-600);">Rol:</strong>
                    <span style="background: ${usuario.rol === 'admin' ? 'var(--green-100)' : 'var(--blue-100)'}; padding: 2px 8px; border-radius: 12px; font-size: 12px;">${usuario.rol}</span>
                  </div>
                </div>
              </div>
            `;
          });
          
          html += `</div></div>`;
          resultDiv.innerHTML = html;
        } else {
          resultDiv.innerHTML = `<div class="result-container">❌ No se encontraron usuarios</div>`;
        }
      })
      .catch(() => {
        resultDiv.innerHTML = `<div class="result-container">❌ Error al buscar usuario</div>`;
      });
    });
  </script>
</body>
</html>
